@{
    ViewData["Title"] = "Đặt lại mật khẩu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" style="max-width: 550px; margin-top: 60px; margin-bottom: 60px;">
    <div class="card shadow-lg border-0 rounded-lg">
        <div class="card-body p-5">
            <div class="text-center mb-4">
                <i class="fas fa-lock fa-3x text-primary mb-3"></i>
                <h2 class="font-weight-light">Đặt lại mật khẩu</h2>
                <p class="text-muted">
                    Vui lòng nhập mã OTP đã được gửi đến email:<br />
                    <strong class="text-dark">@ViewBag.Email</strong>
                </p>
            </div>

            <!-- Hiển thị thông báo lỗi nếu có -->
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i> @TempData["Error"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <form asp-action="ResetMatKhau" method="post" id="resetForm">
                <input type="hidden" name="email" value="@ViewBag.Email" />

                <div class="form-floating mb-3">
                    <input type="text" class="form-control text-center text-primary fw-bold" id="otp" name="otp" required maxlength="4" style="font-size: 1.5rem; letter-spacing: 8px;">
                    <label for="otp" class="text-center w-100">MÃ OTP (4 SỐ)</label>
                </div>

                <hr class="my-4" />

                <div class="form-floating mb-3">
                    <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="Mật khẩu mới" required minlength="6">
                    <label for="newPassword"><i class="fas fa-key me-1"></i> Mật khẩu mới</label>
                </div>

                <div class="form-floating mb-4">
                    <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Xác nhận mật khẩu" required minlength="4">
                    <label for="confirmPassword"><i class="fas fa-check-circle me-1"></i> Xác nhận mật khẩu</label>
                    <div id="passwordError" class="text-danger small mt-1" style="display:none;">
                        <i class="fas fa-times-circle"></i> Mật khẩu xác nhận không khớp!
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save me-2"></i> Lưu mật khẩu mới
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('resetForm').addEventListener('submit', function(event) {
            var pass = document.getElementById('newPassword').value;
            var confirm = document.getElementById('confirmPassword').value;
            var errorDiv = document.getElementById('passwordError');

            if (pass !== confirm) {
                event.preventDefault(); 
                errorDiv.style.display = 'block';
                document.getElementById('confirmPassword').classList.add('is-invalid');
            } else {
                errorDiv.style.display = 'none';
                document.getElementById('confirmPassword').classList.remove('is-invalid');
            }
        });

        document.getElementById('otp').addEventListener('input', function() {
            if (this.value.length === 4) {
                document.getElementById('newPassword').focus();
            }
        });
    </script>
}